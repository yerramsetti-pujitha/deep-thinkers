// This code runs on Vercel's servers, NOT the user's browser.
export default async function handler(req, res) {
  // 1. Get data from the frontend
  const { mood, energy, sleep } = req.body;

  // 2. The Secret Key (Stored in Vercel Dashboard, not in code!)
  const GROQ_API_KEY = process.env.GROQ_API_KEY;

  const systemPrompt = `You are Aromi, an adaptive health coach. Provide a JSON plan for: 
                        Mood ${mood}/10, Energy ${energy}/10, Sleep ${sleep}hrs. 
                        Format: {"workout": "...", "meal_plan": "...", "mental_focus": "..."}`;

  try {
    const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${GROQ_API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "llama3-70b-8192",
        messages: [{ role: "system", content: systemPrompt }],
        response_format: { type: "json_object" }
      })
    });

    const data = await response.json();
    // 3. Send the AI's answer back to the frontend
    res.status(200).json(JSON.parse(data.choices[0].message.content));
  } catch (error) {
    res.status(500).json({ error: "Failed to reach Aromi's brain." });
  }
}
